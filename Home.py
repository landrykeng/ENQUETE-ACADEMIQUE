import streamlit as st
import plotly.graph_objects as go
import plotly.express as px
from datetime import datetime, timedelta
import pandas as pd
from PIL import Image
from my_fonction import *
from Authentification import *

# Configuration de la page
st.set_page_config(
    page_title="Suivi d'Enqu√™tes - Yaound√©",
    page_icon="üìä",
    layout="wide",
    initial_sidebar_state="collapsed"
)

#import_users_from_excel()

# Ajout de la police Google Fonts et augmentation de la taille de police globale
st.markdown("""
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<style>
    html, body, [class*="css"]  {
        font-family: 'Britannic Bold', Palatino Linotype, Times New Roman !important;
        font-size: 1.1rem !important;
    }
    h1, h2, h3, h4, h5, h6 {
        font-family: 'Britannic Bold', Palatino Linotype, Times New Roman !important;
        letter-spacing: 0.01em;
    }
</style>
""", unsafe_allow_html=True)

# CSS personnalis√© pour le style
st.markdown("""
<style>
    .main-header {
        background: linear-gradient(135deg, #2E8B57 0%, #228B22 100%);
        padding: 2rem;
        border-radius: 15px;
        margin-bottom: 2rem;
        color: white;
        text-align: center;
        box-shadow: 0 8px 32px rgba(0,0,0,0.15);
    }
    
    .logo-container {
        display: flex;
        justify-content: center;
        align-items: center;
        margin-bottom: 1rem;
        font-size: 2.5rem;
        font-weight: 700;
    }
    
    .survey-card {
        background: white;
        padding: 2rem;
        border-radius: 20px;
        box-shadow: 0 6px 25px rgba(0,0,0,0.1);
        border-left: 6px solid;
        margin-bottom: 1.5rem;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
    }
    
    .survey-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 10px 35px rgba(0,0,0,0.15);
    }
    
    .survey-card-tontine {
        border-left-color: #FF6B35;
        background: linear-gradient(135deg, #fff 0%, #FFF8F5 100%);
    }
    
    .survey-card-dechets {
        border-left-color: #4ECDC4;
        background: linear-gradient(135deg, #fff 0%, #F0FFFE 100%);
    }
    
    .info-card {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 1.5rem;
        border-radius: 15px;
        margin-bottom: 1.5rem;
        box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
    }
    
    .warning-card {
        background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);
        color: #333;
        padding: 1.5rem;
        border-radius: 15px;
        margin-bottom: 1.5rem;
        box-shadow: 0 4px 15px rgba(255, 154, 158, 0.3);
    }
    
    .success-card {
        background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
        color: #333;
        padding: 1.5rem;
        border-radius: 15px;
        margin-bottom: 1.5rem;
        box-shadow: 0 4px 15px rgba(168, 237, 234, 0.3);
    }
    
    .legal-frame {
        background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
        color: #333;
        padding: 1.5rem;
        border-radius: 15px;
        margin-bottom: 1.5rem;
        border: 2px solid #fcb69f;
    }
    
    .status-indicator {
        display: inline-block;
        width: 14px;
        height: 14px;
        border-radius: 50%;
        margin-right: 10px;
        animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
        0% { box-shadow: 0 0 0 0 rgba(76, 175, 80, 0.7); }
        70% { box-shadow: 0 0 0 10px rgba(76, 175, 80, 0); }
        100% { box-shadow: 0 0 0 0 rgba(76, 175, 80, 0); }
    }
    
    .status-active {
        background-color: #4CAF50;
    }
    
    .survey-details {
        background: rgba(0,0,0,0.05);
        padding: 1rem;
        border-radius: 10px;
        margin: 1rem 0;
    }
    
    .confidence-badge {
        position: absolute;
        top: 15px;
        right: 15px;
        background: rgba(255,255,255,0.9);
        color: #333;
        padding: 6px 12px;
        border-radius: 12px;
        font-size: 0.8rem;
        font-weight: 600;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    
    .checklist-item {
        padding: 0.5rem 0;
        border-bottom: 1px solid rgba(0,0,0,0.1);
    }
    
    .checklist-item:last-child {
        border-bottom: none;
    }
    
    .important-highlight {
        background: linear-gradient(135deg, #FFE066 0%, #FF6B6B 100%);
        color: #333;
        padding: 1rem;
        border-radius: 10px;
        margin: 1rem 0;
        font-weight: 600;
        text-align: center;
    }
    
    .team-info {
        background: linear-gradient(135deg, #e3ffe7 0%, #d9e7ff 100%);
        padding: 1.5rem;
        border-radius: 15px;
        margin-bottom: 1.5rem;
        border-left: 4px solid #4CAF50;
    }
</style>
""", unsafe_allow_html=True)

# Ajout du logo officiel local (Logo1_ISSEA doit √™tre dans le dossier du projet ou dans le r√©pertoire appropri√©)

logo_path = "Logo1_ISSEA.png"  # Assurez-vous que ce fichier est dans le m√™me dossier que ce script
logo = Image.open(logo_path)
st.markdown(
    """
    <div style="display: flex; justify-content: center; align-items: center; margin-bottom: 1.5rem;">
    """,
    unsafe_allow_html=True,
)
st.image(logo, width=4020)
st.markdown("</div>", unsafe_allow_html=True)
# Header principal
st.markdown("""
<div class="main-header">
    <div class="logo-container">
        üá®üá≤ SUIVI DE L'ENQU√äTE ACAD√âMIQUE - YAOUND√â
    </div>
    <h2 style="margin: 0; font-weight: 400;">
        Enqu√™tes Socio-√©conomiques dans la Ville de Yaound√©
    </h2>
    <p style="font-size: 1.1rem; margin-top: 1rem; opacity: 0.9;">
        Plateforme de suivi et de contr√¥le qualit√© des donn√©es
    </p>
</div>
""", unsafe_allow_html=True)

# Cadre l√©gal et confidentialit√©
st.markdown("""
<div class="legal-frame">
    <h3>‚öñÔ∏è Cadre L√©gal et Confidentialit√©</h3>
    <p><strong>Loi de r√©f√©rence :</strong> N¬∞2020/10 du 20 juillet 2020 r√©gissant l'activit√© statistique au Cameroun</p>
    <p><strong>Article 13 :</strong> ¬´ Les donn√©es individuelles recueillies dans le cadre des op√©rations de collecte de donn√©es statistiques ne peuvent faire l'objet de divulgation de quelque mani√®re que ce soit, sauf autorisation explicite accord√©e par les personnes physiques ou morales concern√©es. ¬ª</p>
    <p><strong>Zone d'√©tude :</strong> Ville de Yaound√© (7 arrondissements)</p>
    <p><strong>Type d'enqu√™te :</strong> Enqu√™tes m√©nages avec questionnaires structur√©s</p>
</div>
""", unsafe_allow_html=True)

# Donn√©es des enqu√™tes
enquete_tontine = {
    "nom": "Pratique des Tontines au Cameroun",
    "sous_titre": "Cas de la ville de Yaound√©",
    "description": "Enqu√™te sur la connaissance, la participation et l'impact √©conomique des tontines dans les m√©nages yaound√©ens",
    "sections": [
        "Section 0: Information sur la collecte",
        "Section 1: Identification et localisation du m√©nage", 
        "Section 2: Connaissance et participation aux tontines",
        "Section 3: Analyse des pratiques et impacts √©conomiques",
        "Section 4: Pratiques et impacts √©conomiques des tontines",
        "Section 5: Perspectives et recommandations"
    ],
    "questions_cles": [
        "Connaissance des diff√©rents types de tontines",
        "Participation et dur√©e d'adh√©sion",
        "Motivations et avantages per√ßus",
        "Modalit√©s de fonctionnement",
        "Impacts √©conomiques et sociaux",
        "Innovations num√©riques"
    ],
    "statut": "En cours de collecte",
    "date_debut": "08 Juillet 2025",
    "participants_cible": 500,
    "participants_actuels": 287,
    "couleur": "#FF6B35",
    "icon": "üí∞"
}

enquete_dechets = {
    "nom": "Gestion des Ordures √† Yaound√©",
    "sous_titre": "Opinion de la population sur la gestion des d√©chets",
    "description": "Enqu√™te sur la perception, les comportements et les attentes des habitants concernant la gestion des d√©chets",
    "sections": [
        "Section 0: Information sur la collecte/m√©nage",
        "Section 1: Perception de l'insalubrit√© due aux d√©chets",
        "Section 2: √âvaluation des services de collecte (HYSACAM, CUY)",
        "Section 3: Impacts de la mauvaise gestion sur la vie des habitants",
        "Section 4: Comportements, participation et incivisme",
        "Section 5: Attentes, suggestions et voies d'am√©lioration"
    ],
    "questions_cles": [
        "Appr√©ciation de la propret√© du quartier",
        "Fr√©quence des services de collecte",
        "Impacts sanitaires des d√©chets",
        "Comportements de tri et d'√©limination",
        "Participation citoyenne",
        "Suggestions d'am√©lioration"
    ],
    "statut": "En cours de collecte",
    "date_debut": "08 Juillet 2025",
    "participants_cible": 400,
    "participants_actuels": 198,
    "couleur": "#4ECDC4",
    "icon": "üóëÔ∏è"
}

# Affichage des enqu√™tes
col1, col2 = st.columns(2)

with col1:
    st.markdown(f"""
    <div class="survey-card survey-card-tontine">
        <div class="confidence-badge">üîí Confidentiel</div>
        <h2 style="color: {enquete_tontine['couleur']}; margin-bottom: 0.5rem; display: flex; align-items: center;">
            {enquete_tontine['icon']} {enquete_tontine['nom']}
        </h2>
        <h4 style="color: #666; margin-bottom: 1rem; font-weight: 400;">
            {enquete_tontine['sous_titre']}
        </h4>
        <p style="color: #555; margin-bottom: 1.5rem; line-height: 1.6;">
            {enquete_tontine['description']}
        </p>
        <div style="display: flex; align-items: center; margin-bottom: 1rem;">
            <span class="status-indicator status-active"></span>
            <strong>Statut:</strong> {enquete_tontine['statut']}
        </div>
        <div style="margin-bottom: 1rem;">
            <strong>üìÖ D√©but:</strong> {enquete_tontine['date_debut']}<br>
            <strong>üéØ Objectif:</strong> {enquete_tontine['participants_cible']} m√©nages<br>
            <strong>‚úÖ R√©alis√©s:</strong> {enquete_tontine['participants_actuels']} questionnaires
        </div>
        <div class="survey-details">
            <strong>üìã Structure du questionnaire:</strong><br>
            {'<br>'.join(['‚Ä¢ ' + section for section in enquete_tontine['sections']])}
        </div>
    </div>
    """, unsafe_allow_html=True)

with col2:
    st.markdown(f"""
    <div class="survey-card survey-card-dechets">
        <div class="confidence-badge">üîí Confidentiel</div>
        <h2 style="color: {enquete_dechets['couleur']}; margin-bottom: 0.5rem; display: flex; align-items: center;">
            {enquete_dechets['icon']} {enquete_dechets['nom']}
        </h2>
        <h4 style="color: #666; margin-bottom: 1rem; font-weight: 400;">
            {enquete_dechets['sous_titre']}
        </h4>
        <p style="color: #555; margin-bottom: 1.5rem; line-height: 1.6;">
            {enquete_dechets['description']}
        </p>
        <div style="display: flex; align-items: center; margin-bottom: 1rem;">
            <span class="status-indicator status-active"></span>
            <strong>Statut:</strong> {enquete_dechets['statut']}
        </div>
        <div style="margin-bottom: 1rem;">
            <strong>üìÖ D√©but:</strong> {enquete_dechets['date_debut']}<br>
            <strong>üéØ Objectif:</strong> {enquete_dechets['participants_cible']} m√©nages<br>
            <strong>‚úÖ R√©alis√©s:</strong> {enquete_dechets['participants_actuels']} questionnaires
        </div>
        <div class="survey-details">
            <strong>üìã Structure du questionnaire:</strong><br>
            {'<br>'.join(['‚Ä¢ ' + section for section in enquete_dechets['sections']])}
        </div>
    </div>
    """, unsafe_allow_html=True)

# Section d'informations importantes
st.markdown("## üì¢ Informations Importantes")

col_info1, col_info2 = st.columns(2)

with col_info1:
    st.markdown("""
    <div class="important-highlight">
        ‚ö†Ô∏è RAPPEL : Respecter strictement la confidentialit√© des donn√©es collect√©es
    </div>
    """, unsafe_allow_html=True)
    
    st.markdown("""
    <div class="info-card">
        <h4>üéØ Objectifs des Enqu√™tes</h4>
        <p><strong>Enqu√™te Tontines :</strong></p>
        <ul>
            <li>Comprendre la pratique des syst√®mes d'√©pargne rotatifs</li>
            <li>√âvaluer l'impact √©conomique sur les m√©nages</li>
            <li>Identifier les innovations num√©riques</li>
            <li>Proposer des am√©liorations r√©glementaires</li>
        </ul>
        <p><strong>Enqu√™te D√©chets :</strong></p>
        <ul>
            <li>√âvaluer la perception de la gestion des ordures</li>
            <li>Analyser l'efficacit√© des services publics</li>
            <li>Identifier les impacts sanitaires</li>
            <li>Recueillir les suggestions d'am√©lioration</li>
        </ul>
    </div>
    """, unsafe_allow_html=True)

with col_info2:
    st.markdown("""
    <div class="team-info">
        <h4>üë• Organisation de l'√âquipe</h4>
        <p><strong>Hi√©rarchie de supervision :</strong></p>
        <ul>
            <li><strong>Superviseur :</strong> Coordination g√©n√©rale</li>
            <li><strong>Superviseur Assistant :</strong> Support terrain</li>
            <li><strong>Contr√¥leur :</strong> V√©rification qualit√©</li>
            <li><strong>Enqu√™teur :</strong> Collecte de donn√©es</li>
        </ul>
        <p><strong>Zones de couverture :</strong></p>
        <ul>
            <li>Yaound√© 1, 2, 3, 4, 5, 6, 7</li>
            <li>Enqu√™te par quartier avec num√©rotation ZD</li>
        </ul>
    </div>
    """, unsafe_allow_html=True)

# Guide pratique pour les enqu√™teurs
st.markdown("## üìö Guide Pratique - Enqu√™teurs")

col_guide1, col_guide2 = st.columns(2)

with col_guide1:
    st.markdown("""
    <div class="success-card">
        <h4>‚úÖ Bonnes Pratiques - Avant l'Interview</h4>
        <div class="checklist-item">üÜî V√©rifier votre mat√©riel d'identification</div>
        <div class="checklist-item">üìã Pr√©parer le questionnaire et les codes</div>
        <div class="checklist-item">üïí Respecter les horaires convenus</div>
        <div class="checklist-item">üìç Localiser pr√©cis√©ment l'adresse (ZD/Quartier)</div>
        <div class="checklist-item">ü§ù Pr√©sentation courtoise et professionnelle</div>
        <div class="checklist-item">üîí Rappeler la confidentialit√© des donn√©es</div>
    </div>
    """, unsafe_allow_html=True)
    
    st.markdown("""
    <div class="warning-card">
        <h4>‚ö†Ô∏è Points de Vigilance</h4>
        <div class="checklist-item"><strong>Enqu√™te Tontines :</strong> Bien expliquer ce qu'est une tontine si n√©cessaire</div>
        <div class="checklist-item"><strong>Questions sensibles :</strong> Revenus, probl√®mes familiaux</div>
        <div class="checklist-item"><strong>Filtres :</strong> Respecter les conditions de passage entre questions</div>
        <div class="checklist-item"><strong>Codes multiples :</strong> V√©rifier les questions √† choix multiples</div>
        <div class="checklist-item"><strong>Non-r√©ponse :</strong> Noter les motifs pr√©cis</div>
    </div>
    """, unsafe_allow_html=True)

with col_guide2:
    st.markdown("""
    <div class="success-card">
        <h4>‚úÖ Bonnes Pratiques - Pendant l'Interview</h4>
        <div class="checklist-item">üó£Ô∏è Poser les questions dans l'ordre du questionnaire</div>
        <div class="checklist-item">‚úèÔ∏è √âcrire lisiblement dans les cases pr√©vues</div>
        <div class="checklist-item">üîÑ Reformuler si la personne ne comprend pas</div>
        <div class="checklist-item">‚è±Ô∏è Prendre le temps n√©cessaire sans presser</div>
        <div class="checklist-item">üö´ Ne pas influencer les r√©ponses</div>
        <div class="checklist-item">‚úîÔ∏è V√©rifier la coh√©rence des r√©ponses</div>
    </div>
    """, unsafe_allow_html=True)
    
    st.markdown("""
    <div class="info-card">
        <h4>üìû Contacts Utiles</h4>
        <p><strong>Support Technique :</strong> [√Ä compl√©ter]</p>
        <p><strong>Superviseur :</strong> [√Ä compl√©ter]</p>
        <p><strong>Urgences Terrain :</strong> [√Ä compl√©ter]</p>
        <p><strong>Horaires Support :</strong> 8h-18h du lundi au samedi</p>
    </div>
    """, unsafe_allow_html=True)

# Conseils sp√©cifiques par enqu√™te
st.markdown("## üéØ Conseils Sp√©cifiques par Enqu√™te")

col_spec1, col_spec2 = st.columns(2)

with col_spec1:
    st.markdown(f"""
    <div class="survey-card survey-card-tontine">
        <h4 style="color: {enquete_tontine['couleur']};">üí∞ Sp√©cificit√©s Enqu√™te Tontines</h4>
        <p><strong>D√©finition √† retenir :</strong> Une tontine est un syst√®me d'√©pargne et de cr√©dit rotatif o√π les membres cotisent r√©guli√®rement et re√ßoivent √† tour de r√¥le la somme totale collect√©e.</p>
        
        <p><strong>Types de tontines √† identifier :</strong></p>
        <ul>
            <li>Tontines d'√©pargne (classiques)</li>
            <li>Tontines de cr√©dit (pr√™t collectif)</li>
            <li>Tontines festives (c√©l√©brations)</li>
            <li>Tontines d'aide mutuelle</li>
            <li>Tontines agricoles/rurales</li>
            <li>Tontines d'achat collectif</li>
        </ul>
        
        <p><strong>Questions d√©licates :</strong></p>
        <ul>
            <li>Montants des cotisations (tranches propos√©es)</li>
            <li>Probl√®mes v√©cus (d√©tournements, conflits)</li>
            <li>Revenus du m√©nage</li>
        </ul>
        
        <p><strong>Innovation num√©rique :</strong> Mobile Money, WhatsApp, plateformes web</p>
    </div>
    """, unsafe_allow_html=True)

with col_spec2:
    st.markdown(f"""
    <div class="survey-card survey-card-dechets">
        <h4 style="color: {enquete_dechets['couleur']};">üóëÔ∏è Sp√©cificit√©s Enqu√™te D√©chets</h4>
        <p><strong>Acteurs √† conna√Ætre :</strong></p>
        <ul>
            <li><strong>HYSACAM :</strong> Soci√©t√© de collecte des ordures</li>
            <li><strong>CUY :</strong> Communaut√© Urbaine de Yaound√©</li>
            <li><strong>MINEPDED :</strong> Minist√®re de l'Environnement</li>
            <li><strong>MINHDU :</strong> Minist√®re de l'Habitat et du D√©veloppement Urbain</li>
        </ul>
        
        <p><strong>Types de d√©chets √† identifier :</strong></p>
        <ul>
            <li>Plastiques (bouteilles, emballages)</li>
            <li>D√©chets organiques (restes alimentaires)</li>
            <li>Papiers et cartons</li>
            <li>Verre et m√©taux</li>
            <li>D√©chets dangereux (piles, m√©dicaments)</li>
        </ul>
        
        <p><strong>Zones sensibles :</strong> March√©s, carrefours, caniveaux, abords habitations</p>
        
        <p><strong>Maladies √† noter :</strong> Diarrh√©es, paludisme, allergies, d√©mangeaisons</p>
    </div>
    """, unsafe_allow_html=True)

# Guide pour les contr√¥leurs
st.markdown("## üîç Guide Pratique - Contr√¥leurs")

st.markdown("""
<div class="info-card">
    <h4>üìã Points de Contr√¥le Qualit√©</h4>
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
        <div>
            <p><strong>‚úÖ V√©rifications Formelles :</strong></p>
            <ul>
                <li>Identification compl√®te du m√©nage</li>
                <li>Num√©rotation s√©quentielle correcte</li>
                <li>Codes de r√©ponse dans les bonnes cases</li>
                <li>√âcriture lisible et encre durable</li>
                <li>Signature de l'enqu√™teur</li>
                <li>Date et heure de l'interview</li>
            </ul>
        </div>
        <div>
            <p><strong>‚úÖ V√©rifications de Coh√©rence :</strong></p>
            <ul>
                <li>√Çge et niveau d'√©ducation coh√©rents</li>
                <li>Emploi et tranche de revenus compatibles</li>
                <li>Filtres de questions respect√©s</li>
                <li>Nombre de membres du m√©nage exact</li>
                <li>Localisation g√©ographique pr√©cise</li>
                <li>R√©ponses multiples bien marqu√©es</li>
            </ul>
        </div>
    </div>
    
    
    üéØ Objectif : Taux de qualit√© > 95% pour validation des questionnaires
    
</div>
""", unsafe_allow_html=True)

# Sidebar am√©lior√©e
with st.sidebar:
    st.markdown("### üß≠ Navigation")
    st.markdown("- üè† **Accueil** (Actuel)")
    st.markdown("- üí∞ Enqu√™te Tontines")
    st.markdown("- üóëÔ∏è Enqu√™te D√©chets")
    st.markdown("- üìä Tableau de Bord")
    st.markdown("- üìà Analytics Avanc√©s")
    st.markdown("- üìã Rapports & Exports")
    st.markdown("- ‚öôÔ∏è Configuration")
    
    st.markdown("---")
    st.markdown("### üìç Zone d'√âtude")
    st.info("**Yaound√© - 7 Arrondissements**\n\n"
            "‚Ä¢ Yaound√© 1 - Centre-ville\n"
            "‚Ä¢ Yaound√© 2 - Tsinga, Emana\n" 
            "‚Ä¢ Yaound√© 3 - Efoulan\n"
            "‚Ä¢ Yaound√© 4 - Kondengui\n"
            "‚Ä¢ Yaound√© 5 - Essos\n"
            "‚Ä¢ Yaound√© 6 - Biyem-Assi\n"
            "‚Ä¢ Yaound√© 7 - Nkolbisson")
    
    st.markdown("---")
    st.markdown("### üìû Support")
    st.warning("**Assistance Technique**\n\n"
               "En cas de probl√®me :\n"
               "‚Ä¢ Contacter le superviseur\n"
               "‚Ä¢ Documenter les incidents\n"
               "‚Ä¢ Signaler les refus\n"
               "‚Ä¢ Noter les adresses introuvables")
    
    st.markdown("---")
    st.markdown("### ‚è∞ Statut Actuel")
    current_time = datetime.now().strftime("%H:%M")
    current_date = datetime.now().strftime("%d/%m/%Y")
    st.success(f"**{current_date}**\n{current_time}\n\n‚úÖ Syst√®me Op√©rationnel")

# Footer
st.markdown("---")
st.markdown("""
<div style="text-align: center; color: #666; padding: 2rem;">
    <p>üá®üá≤ <strong>R√©publique du Cameroun</strong> - Enqu√™tes Socio-√©conomiques Yaound√©</p>
    <p>Plateforme de suivi d√©velopp√©e dans le respect de la Loi N¬∞2020/10 du 20 juillet 2020</p>
    <p><em>Donn√©es confidentielles - Usage strictement professionnel</em></p>
</div>
""", unsafe_allow_html=True)